<!-- 简化的Live2D板娘 - 浮在所有元素之上 -->
<div id="live2d-container" style="position: fixed; left: 20px; bottom: 20px; z-index: 99999; width: 200px; height: 180px; border-radius: 15px; overflow: hidden; background: rgba(0,0,0,0.1); border: 2px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); pointer-events: auto;">
  <canvas id="live2d-canvas" width="200" height="180" style="width: 100%; height: 100%; display: block;"></canvas>
  <div id="model-info" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 10px; font-size: 12px; opacity: 0.8; z-index: 100000;">
    <span id="current-model">MIHARI</span>
  </div>
  <div id="model-controls" style="position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; z-index: 100000;">
    <button id="prev-model" style="width: 25px; height: 25px; border: none; border-radius: 50%; background: rgba(255,255,255,0.8); color: #333; cursor: pointer; font-size: 12px;">←</button>
    <button id="next-model" style="width: 25px; height: 25px; border: none; border-radius: 50%; background: rgba(255,255,255,0.8); color: #333; cursor: pointer; font-size: 12px;">→</button>
  </div>
</div>

<script>
// 简化的Live2D实现 - 自动切换模型
(function() {
  'use strict';
  
  // 模型列表
  const models = [
    { name: 'MIHARI', color: '#ff6b6b' },
    { name: 'Rory', color: '#74b9ff' },
    { name: 'Alya', color: '#a29bfe' }
  ];
  
  let currentModelIndex = 0;
  let autoSwitchInterval;
  
  const canvas = document.getElementById('live2d-canvas');
  const ctx = canvas.getContext('2d');
  const modelInfo = document.getElementById('current-model');
  const prevBtn = document.getElementById('prev-model');
  const nextBtn = document.getElementById('next-model');
  
  // 绘制模型占位符
  function drawModelPlaceholder(model) {
    // 清空画布
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 绘制背景渐变
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, 'rgba(0,0,0,0.1)');
    gradient.addColorStop(1, 'rgba(0,0,0,0.3)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // 绘制圆形头像
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2 - 20, 40, 0, 2 * Math.PI);
    ctx.fillStyle = model.color;
    ctx.fill();
    
    // 绘制模型名称
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(model.name, canvas.width/2, canvas.height/2 + 30);
    
    // 绘制状态信息
    ctx.font = '12px Arial';
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.fillText('Live2D模型', canvas.width/2, canvas.height/2 + 50);
    
    // 绘制切换提示
    ctx.font = '10px Arial';
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.fillText('每1分钟自动切换', canvas.width/2, canvas.height/2 + 65);
  }
  
  // 切换到指定模型
  function switchToModel(index) {
    currentModelIndex = index;
    const model = models[currentModelIndex];
    
    // 更新显示
    modelInfo.textContent = model.name;
    modelInfo.style.color = model.color;
    
    // 绘制模型
    drawModelPlaceholder(model);
    
    console.log(`🎭 切换到模型: ${model.name}`);
  }
  
  // 下一个模型
  function nextModel() {
    const nextIndex = (currentModelIndex + 1) % models.length;
    switchToModel(nextIndex);
  }
  
  // 上一个模型
  function prevModel() {
    const prevIndex = (currentModelIndex - 1 + models.length) % models.length;
    switchToModel(prevIndex);
  }
  
  // 自动切换
  function startAutoSwitch() {
    autoSwitchInterval = setInterval(() => {
      nextModel();
    }, 60000); // 1分钟 = 60000毫秒
    
    console.log('🔄 启动自动切换，每1分钟切换一次模型');
  }
  
  // 事件监听
  prevBtn.addEventListener('click', prevModel);
  nextBtn.addEventListener('click', nextModel);
  
  // 鼠标悬停效果
  const container = document.getElementById('live2d-container');
  container.addEventListener('mouseenter', function() {
    this.style.transform = 'scale(1.05)';
    this.style.transition = 'transform 0.3s ease';
  });
  
  container.addEventListener('mouseleave', function() {
    this.style.transform = 'scale(1)';
  });
  
  // 初始化
  function init() {
    console.log('🎭 初始化简化版Live2D...');
    
    // 绘制第一个模型
    switchToModel(0);
    
    // 启动自动切换
    startAutoSwitch();
    
    console.log('✅ 简化版Live2D初始化完成');
  }
  
  // 页面加载完成后初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  // 暴露控制函数到全局
  window.Live2DControls = {
    nextModel,
    prevModel,
    switchToModel,
    startAutoSwitch,
    stopAutoSwitch: () => clearInterval(autoSwitchInterval)
  };
  
})();
</script>

<!-- 音乐播放器 - 浮在最上层 -->
<div id="music-player" style="position: fixed; right: 20px; bottom: 20px; z-index: 99999; width: 320px; height: auto; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); pointer-events: auto;">
  <div style="color: white; font-size: 14px; margin-bottom: 10px; text-align: center;">🎵 音乐播放器</div>
  <audio id="local-audio" controls style="width: 280px; height: 40px;" src="{{ '/assets/audio/Summer.mp3' | relative_url }}">
    你的浏览器不支持音频播放
  </audio>
  <div style="margin-top: 10px; text-align: center;">
    <button id="play-btn" style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-right: 10px;">播放</button>
    <button id="pause-btn" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">暂停</button>
  </div>
</div>

<script>
// 音乐播放器控制
document.addEventListener('DOMContentLoaded', function() {
  const audio = document.getElementById('local-audio');
  const playBtn = document.getElementById('play-btn');
  const pauseBtn = document.getElementById('pause-btn');
  
  playBtn.addEventListener('click', function() {
    audio.play().then(() => {
      console.log('🎵 开始播放音乐');
    }).catch(err => {
      console.log('❌ 播放失败:', err.message);
    });
  });
  
  pauseBtn.addEventListener('click', function() {
    audio.pause();
    console.log('⏸️ 音乐已暂停');
  });
  
  // 音频加载完成后的处理
  audio.addEventListener('loadeddata', function() {
    console.log('✅ 音频文件加载完成');
  });
  
  audio.addEventListener('error', function(e) {
    console.error('❌ 音频加载失败:', e);
  });
});
</script>
