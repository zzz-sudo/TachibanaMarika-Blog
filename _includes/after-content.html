<!-- ç®€åŒ–çš„Live2Dæ¿å¨˜ - æµ®åœ¨æ‰€æœ‰å…ƒç´ ä¹‹ä¸Š -->
<div id="live2d-container" style="position: fixed; left: 20px; bottom: 20px; z-index: 99999; width: 200px; height: 180px; border-radius: 15px; overflow: hidden; background: rgba(0,0,0,0.1); border: 2px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); pointer-events: auto;">
  <canvas id="live2d-canvas" width="200" height="180" style="width: 100%; height: 100%; display: block;"></canvas>
  <div id="model-info" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 10px; font-size: 12px; opacity: 0.8; z-index: 100000;">
    <span id="current-model">MIHARI</span>
  </div>
  <div id="model-controls" style="position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; z-index: 100000;">
    <button id="prev-model" style="width: 25px; height: 25px; border: none; border-radius: 50%; background: rgba(255,255,255,0.8); color: #333; cursor: pointer; font-size: 12px;">â†</button>
    <button id="next-model" style="width: 25px; height: 25px; border: none; border-radius: 50%; background: rgba(255,255,255,0.8); color: #333; cursor: pointer; font-size: 12px;">â†’</button>
  </div>
</div>

<script>
// ç®€åŒ–çš„Live2Då®ç° - è‡ªåŠ¨åˆ‡æ¢æ¨¡å‹
(function() {
  'use strict';
  
  // æ¨¡å‹åˆ—è¡¨
  const models = [
    { name: 'MIHARI', color: '#ff6b6b' },
    { name: 'Rory', color: '#74b9ff' },
    { name: 'Alya', color: '#a29bfe' }
  ];
  
  let currentModelIndex = 0;
  let autoSwitchInterval;
  
  const canvas = document.getElementById('live2d-canvas');
  const ctx = canvas.getContext('2d');
  const modelInfo = document.getElementById('current-model');
  const prevBtn = document.getElementById('prev-model');
  const nextBtn = document.getElementById('next-model');
  
  // ç»˜åˆ¶æ¨¡å‹å ä½ç¬¦
  function drawModelPlaceholder(model) {
    // æ¸…ç©ºç”»å¸ƒ
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ç»˜åˆ¶èƒŒæ™¯æ¸å˜
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, 'rgba(0,0,0,0.1)');
    gradient.addColorStop(1, 'rgba(0,0,0,0.3)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // ç»˜åˆ¶åœ†å½¢å¤´åƒ
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2 - 20, 40, 0, 2 * Math.PI);
    ctx.fillStyle = model.color;
    ctx.fill();
    
    // ç»˜åˆ¶æ¨¡å‹åç§°
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(model.name, canvas.width/2, canvas.height/2 + 30);
    
    // ç»˜åˆ¶çŠ¶æ€ä¿¡æ¯
    ctx.font = '12px Arial';
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.fillText('Live2Dæ¨¡å‹', canvas.width/2, canvas.height/2 + 50);
    
    // ç»˜åˆ¶åˆ‡æ¢æç¤º
    ctx.font = '10px Arial';
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.fillText('æ¯1åˆ†é’Ÿè‡ªåŠ¨åˆ‡æ¢', canvas.width/2, canvas.height/2 + 65);
  }
  
  // åˆ‡æ¢åˆ°æŒ‡å®šæ¨¡å‹
  function switchToModel(index) {
    currentModelIndex = index;
    const model = models[currentModelIndex];
    
    // æ›´æ–°æ˜¾ç¤º
    modelInfo.textContent = model.name;
    modelInfo.style.color = model.color;
    
    // ç»˜åˆ¶æ¨¡å‹
    drawModelPlaceholder(model);
    
    console.log(`ğŸ­ åˆ‡æ¢åˆ°æ¨¡å‹: ${model.name}`);
  }
  
  // ä¸‹ä¸€ä¸ªæ¨¡å‹
  function nextModel() {
    const nextIndex = (currentModelIndex + 1) % models.length;
    switchToModel(nextIndex);
  }
  
  // ä¸Šä¸€ä¸ªæ¨¡å‹
  function prevModel() {
    const prevIndex = (currentModelIndex - 1 + models.length) % models.length;
    switchToModel(prevIndex);
  }
  
  // è‡ªåŠ¨åˆ‡æ¢
  function startAutoSwitch() {
    autoSwitchInterval = setInterval(() => {
      nextModel();
    }, 60000); // 1åˆ†é’Ÿ = 60000æ¯«ç§’
    
    console.log('ğŸ”„ å¯åŠ¨è‡ªåŠ¨åˆ‡æ¢ï¼Œæ¯1åˆ†é’Ÿåˆ‡æ¢ä¸€æ¬¡æ¨¡å‹');
  }
  
  // äº‹ä»¶ç›‘å¬
  prevBtn.addEventListener('click', prevModel);
  nextBtn.addEventListener('click', nextModel);
  
  // é¼ æ ‡æ‚¬åœæ•ˆæœ
  const container = document.getElementById('live2d-container');
  container.addEventListener('mouseenter', function() {
    this.style.transform = 'scale(1.05)';
    this.style.transition = 'transform 0.3s ease';
  });
  
  container.addEventListener('mouseleave', function() {
    this.style.transform = 'scale(1)';
  });
  
  // åˆå§‹åŒ–
  function init() {
    console.log('ğŸ­ åˆå§‹åŒ–ç®€åŒ–ç‰ˆLive2D...');
    
    // ç»˜åˆ¶ç¬¬ä¸€ä¸ªæ¨¡å‹
    switchToModel(0);
    
    // å¯åŠ¨è‡ªåŠ¨åˆ‡æ¢
    startAutoSwitch();
    
    console.log('âœ… ç®€åŒ–ç‰ˆLive2Dåˆå§‹åŒ–å®Œæˆ');
  }
  
  // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  // æš´éœ²æ§åˆ¶å‡½æ•°åˆ°å…¨å±€
  window.Live2DControls = {
    nextModel,
    prevModel,
    switchToModel,
    startAutoSwitch,
    stopAutoSwitch: () => clearInterval(autoSwitchInterval)
  };
  
})();
</script>

<!-- éŸ³ä¹æ’­æ”¾å™¨ - æµ®åœ¨æœ€ä¸Šå±‚ -->
<div id="music-player" style="position: fixed; right: 20px; bottom: 20px; z-index: 99999; width: 320px; height: auto; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); pointer-events: auto;">
  <div style="color: white; font-size: 14px; margin-bottom: 10px; text-align: center;">ğŸµ éŸ³ä¹æ’­æ”¾å™¨</div>
  <audio id="local-audio" controls style="width: 280px; height: 40px;" src="{{ '/assets/audio/Summer.mp3' | relative_url }}">
    ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
  </audio>
  <div style="margin-top: 10px; text-align: center;">
    <button id="play-btn" style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-right: 10px;">æ’­æ”¾</button>
    <button id="pause-btn" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">æš‚åœ</button>
  </div>
</div>

<script>
// éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶
document.addEventListener('DOMContentLoaded', function() {
  const audio = document.getElementById('local-audio');
  const playBtn = document.getElementById('play-btn');
  const pauseBtn = document.getElementById('pause-btn');
  
  playBtn.addEventListener('click', function() {
    audio.play().then(() => {
      console.log('ğŸµ å¼€å§‹æ’­æ”¾éŸ³ä¹');
    }).catch(err => {
      console.log('âŒ æ’­æ”¾å¤±è´¥:', err.message);
    });
  });
  
  pauseBtn.addEventListener('click', function() {
    audio.pause();
    console.log('â¸ï¸ éŸ³ä¹å·²æš‚åœ');
  });
  
  // éŸ³é¢‘åŠ è½½å®Œæˆåçš„å¤„ç†
  audio.addEventListener('loadeddata', function() {
    console.log('âœ… éŸ³é¢‘æ–‡ä»¶åŠ è½½å®Œæˆ');
  });
  
  audio.addEventListener('error', function(e) {
    console.error('âŒ éŸ³é¢‘åŠ è½½å¤±è´¥:', e);
  });
});
</script>
