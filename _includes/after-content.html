<!-- Live2D 三位置板娘 -->
<link rel="stylesheet" type="text/css" href="https://blog-static.cnblogs.com/files/zhangshuhao1116/waifu1.css"/>
<link rel="stylesheet" type="text/css" href="https://blog-static.cnblogs.com/files/zhangshuhao1116/flat-ui.min.css"/>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

<!-- 板娘1 - MIHARI (左侧) -->
<div class="waifu" id="waifu1" style="left: 20px; bottom: 0; z-index: 9999;">
  <div class="waifu-tips" style="opacity: 1;"></div>
  <canvas id="live2d1" width="280" height="250" class="live2d"></canvas>
  <div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-chat"></span>
    <span class="fui-eye"></span>
    <span class="fui-user"></span>
    <span class="fui-photo"></span>
    <span class="fui-info-circle"></span>
    <span class="fui-cross"></span>
  </div>
</div>

<!-- 板娘2 - Rory (中间) -->
<div class="waifu" id="waifu2" style="left: 320px; bottom: 0; z-index: 9999;">
  <div class="waifu-tips" style="opacity: 1;"></div>
  <canvas id="live2d2" width="280" height="250" class="live2d"></canvas>
  <div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-chat"></span>
    <span class="fui-eye"></span>
    <span class="fui-user"></span>
    <span class="fui-photo"></span>
    <span class="fui-info-circle"></span>
    <span class="fui-cross"></span>
  </div>
</div>

<!-- 板娘3 - Alya (右侧) -->
<div class="waifu" id="waifu3" style="left: 620px; bottom: 0; z-index: 9999;">
  <div class="waifu-tips" style="opacity: 1;"></div>
  <canvas id="live2d3" width="280" height="250" class="live2d"></canvas>
  <div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-chat"></span>
    <span class="fui-eye"></span>
    <span class="fui-user"></span>
    <span class="fui-photo"></span>
    <span class="fui-info-circle"></span>
    <span class="fui-cross"></span>
  </div>
</div>

<!-- 引入Live2D脚本 -->
<script src="https://blog-static.cnblogs.com/files/zhangshuhao1116/live2d.min.js"></script>
<script src="https://blog-static.cnblogs.com/files/zhangshuhao1116/waifu-tips.js"></script>

<!-- 初始化多个模型 -->
<script type="text/javascript">
  // 等待页面加载完成后初始化
  document.addEventListener('DOMContentLoaded', function() {
    console.log('开始初始化三个Live2D板娘');
    
    // 初始化板娘1（MIHARI）
    try {
      initModel("live2d1", "waifu1");
      console.log('板娘1 (MIHARI) 初始化成功');
    } catch (error) {
      console.error('板娘1初始化失败:', error);
    }
    
    // 初始化板娘2（Rory）
    try {
      initModel("live2d2", "waifu2");
      console.log('板娘2 (Rory) 初始化成功');
    } catch (error) {
      console.error('板娘2初始化失败:', error);
    }
    
    // 初始化板娘3（Alya）
    try {
      initModel("live2d3", "waifu3");
      console.log('板娘3 (Alya) 初始化成功');
    } catch (error) {
      console.error('板娘3初始化失败:', error);
    }
  });
</script>

<!-- 网易云音乐插件及本地备用方案 -->
<div style="position: fixed; right: 20px; bottom: 20px; z-index: 10000;">
  <!-- 网易云播放器 -->
  <div id="neteasePlayerContainer">
    <iframe 
      id="neteasePlayer"
      frameborder="no" 
      border="0" 
      marginwidth="0" 
      marginheight="0" 
      width="330" 
      height="86" 
      src="https://music.163.com/outchain/player?type=2&id=14177411150&auto=1&height=66">
    </iframe>
  </div>
  
  <!-- 本地MP3备用播放器 (默认隐藏) -->
  <div id="localPlayerContainer" style="display: none; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
    <p style="margin: 0 0 10px 0; font-size: 12px; color: #fff; text-align: center;">网易云播放失败，使用本地备份</p>
    <audio 
      id="localPlayer" 
      controls 
      style="width: 300px; height: 40px;"
      src="/assets/audio/Summer (Nature's Crescendo).mp3">
      你的浏览器不支持音频播放
    </audio>
  </div>
</div>

<script>
// 检测网易云播放器是否加载成功
function checkNeteasePlayer() {
  // 等待页面加载完成后检查
  setTimeout(() => {
    const neteaseContainer = document.getElementById('neteasePlayerContainer');
    const localContainer = document.getElementById('localPlayerContainer');
    
    // 检查iframe是否正常加载
    const iframe = document.getElementById('neteasePlayer');
    if (iframe) {
      // 尝试检测iframe内容是否加载成功
      try {
        // 简单的尺寸检测：如果iframe加载失败，高度可能异常
        const isLoaded = iframe.offsetHeight > 60; // 正常加载时高度应大于60px
        
        if (!isLoaded) {
          console.log('网易云播放器加载失败，切换到本地播放器');
          // 网易云播放器加载失败，显示本地播放器
          neteaseContainer.style.display = 'none';
          localContainer.style.display = 'block';
          
          // 自动播放本地音频
          const localPlayer = document.getElementById('localPlayer');
          if (localPlayer) {
            // 尝试自动播放（受浏览器政策限制）
            localPlayer.play().catch(err => {
              console.log('自动播放失败，需要用户交互:', err);
            });
          }
        } else {
          console.log('网易云播放器加载成功');
        }
      } catch (error) {
        console.error('检测播放器状态时出错:', error);
        // 出错时也切换到本地播放器
        neteaseContainer.style.display = 'none';
        localContainer.style.display = 'block';
      }
    }
  }, 3000); // 3秒后检查，给足加载时间
}

// 页面加载完成后执行检测
window.addEventListener('load', checkNeteasePlayer);

// 如果网易云播放器加载失败，提供手动切换按钮
document.addEventListener('DOMContentLoaded', function() {
  // 添加一个小的切换按钮
  const toggleButton = document.createElement('div');
  toggleButton.innerHTML = '🎵';
  toggleButton.style.cssText = `
    position: fixed;
    right: 20px;
    bottom: 120px;
    z-index: 10001;
    width: 30px;
    height: 30px;
    background: rgba(0,0,0,0.7);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
  `;
  
  toggleButton.addEventListener('click', function() {
    const neteaseContainer = document.getElementById('neteasePlayerContainer');
    const localContainer = document.getElementById('localPlayerContainer');
    
    if (neteaseContainer.style.display !== 'none') {
      neteaseContainer.style.display = 'none';
      localContainer.style.display = 'block';
      this.style.background = 'rgba(255,0,0,0.7)';
      this.innerHTML = '🎧';
    } else {
      neteaseContainer.style.display = 'block';
      localContainer.style.display = 'none';
      this.style.background = 'rgba(0,0,0,0.7)';
      this.innerHTML = '🎵';
    }
  });
  
  // 添加悬停效果
  toggleButton.addEventListener('mouseenter', function() {
    this.style.transform = 'scale(1.1)';
  });
  
  toggleButton.addEventListener('mouseleave', function() {
    this.style.transform = 'scale(1)';
  });
  
  document.body.appendChild(toggleButton);
});
</script>
