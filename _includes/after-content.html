<!-- Live2D ä¸‰ä½ç½®æ¿å¨˜ - å·¦ä¾§å¸ƒå±€ -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/flat-ui.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

<!-- æ¿å¨˜1 - MIHARI (å·¦ä¾§åä¸Š) -->
<div class="waifu" id="waifu1" style="left: 20px; top: 100px; z-index: 9999; position: fixed;">
  <div class="waifu-tips" style="opacity: 1;"></div>
  <canvas id="live2d1" width="200" height="180" class="live2d"></canvas>
  <div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-chat"></span>
    <span class="fui-eye"></span>
    <span class="fui-user"></span>
    <span class="fui-photo"></span>
    <span class="fui-info-circle"></span>
    <span class="fui-cross"></span>
  </div>
</div>

<!-- æ¿å¨˜2 - Rory (å·¦ä¾§ä¸­é—´) -->
<div class="waifu" id="waifu2" style="left: 20px; top: 50%; transform: translateY(-50%); z-index: 9999; position: fixed;">
  <div class="waifu-tips" style="opacity: 1;"></div>
  <canvas id="live2d2" width="200" height="180" class="live2d"></canvas>
  <div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-chat"></span>
    <span class="fui-eye"></span>
    <span class="fui-user"></span>
    <span class="fui-photo"></span>
    <span class="fui-info-circle"></span>
    <span class="fui-cross"></span>
  </div>
</div>

<!-- æ¿å¨˜3 - Alya (å·¦ä¾§åä¸‹) -->
<div class="waifu" id="waifu3" style="left: 20px; bottom: 100px; z-index: 9999; position: fixed;">
  <div class="waifu-tips" style="opacity: 1;"></div>
  <canvas id="live2d3" width="200" height="180" class="live2d"></canvas>
  <div class="waifu-tool">
    <span class="fui-home"></span>
    <span class="fui-chat"></span>
    <span class="fui-eye"></span>
    <span class="fui-user"></span>
    <span class="fui-photo"></span>
    <span class="fui-info-circle"></span>
    <span class="fui-cross"></span>
  </div>
</div>

<!-- å¼•å…¥Live2Dè„šæœ¬ -->
<script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/live2d.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu-tips.js"></script>

<!-- åˆå§‹åŒ–å¤šä¸ªæ¨¡å‹ -->
<script type="text/javascript">
  // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', function() {
    console.log('=== Live2D åˆå§‹åŒ–å¼€å§‹ ===');
    
    // æ£€æŸ¥jQueryæ˜¯å¦åŠ è½½
    if (typeof $ === 'undefined') {
      console.error('âŒ jQueryæœªåŠ è½½ï¼ŒLive2Dæ— æ³•æ­£å¸¸å·¥ä½œ');
      showAllFallbackContent();
      return;
    }
    
    // æ£€æŸ¥Live2Dè„šæœ¬æ˜¯å¦åŠ è½½
    if (typeof Live2DModel === 'undefined' && typeof initModel === 'undefined' && typeof initWidget === 'undefined') {
      console.error('âŒ Live2Dæ ¸å¿ƒè„šæœ¬æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      showAllFallbackContent();
      return;
    }
    
    // æ£€æŸ¥å¯ç”¨çš„Live2Då‡½æ•°
    console.log('ğŸ” æ£€æŸ¥å¯ç”¨çš„Live2Då‡½æ•°:');
    console.log('Live2DModel:', typeof Live2DModel);
    console.log('initModel:', typeof initModel);
    console.log('initWidget:', typeof initWidget);
    console.log('window.Live2D:', typeof window.Live2D);
    
    console.log('âœ… åŸºç¡€ä¾èµ–æ£€æŸ¥é€šè¿‡');
    
    // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
    setTimeout(function() {
      console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–Live2Dæ¨¡å‹...');
      
      // æ£€æŸ¥DOMå…ƒç´ 
      const waifu1 = document.getElementById('waifu1');
      const waifu2 = document.getElementById('waifu2');
      const waifu3 = document.getElementById('waifu3');
      
      if (!waifu1 || !waifu2 || !waifu3) {
        console.error('âŒ æ‰¾ä¸åˆ°Live2Då®¹å™¨å…ƒç´ ');
        return;
      }
      
      console.log('âœ… DOMå…ƒç´ æ£€æŸ¥é€šè¿‡');
      
        // å°è¯•åˆå§‹åŒ–æ¿å¨˜1ï¼ˆMIHARI - åä¸Šï¼‰
      try {
        console.log('ğŸ­ æ­£åœ¨åˆå§‹åŒ–æ¿å¨˜1 (MIHARI)...');
        if (typeof initModel === 'function') {
          // ä½¿ç”¨é»˜è®¤æ¨¡å‹åˆå§‹åŒ–
          initModel("live2d1", "waifu1");
          console.log('âœ… æ¿å¨˜1 (MIHARI) åˆå§‹åŒ–æˆåŠŸ');
        } else if (typeof initWidget === 'function') {
          // å°è¯•ä½¿ç”¨initWidget
          initWidget("live2d1", "waifu1");
          console.log('âœ… æ¿å¨˜1 (MIHARI) ä½¿ç”¨initWidgetåˆå§‹åŒ–æˆåŠŸ');
        } else if (typeof window.Live2D !== 'undefined') {
          // å°è¯•ä½¿ç”¨Live2DåŸç”Ÿæ–¹æ³•
          console.log('ğŸ”„ å°è¯•ä½¿ç”¨Live2DåŸç”Ÿæ–¹æ³•åˆå§‹åŒ–...');
          try {
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„Live2Dæ¨¡å‹
            const canvas = document.getElementById('live2d1');
            if (canvas) {
              const ctx = canvas.getContext('2d');
              // ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„å ä½ç¬¦
              ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
              ctx.fillRect(0, 0, canvas.width, canvas.height);
              ctx.fillStyle = '#fff';
              ctx.font = '16px Arial';
              ctx.textAlign = 'center';
              ctx.fillText('MIHARI', canvas.width/2, canvas.height/2);
              console.log('âœ… æ¿å¨˜1 (MIHARI) ä½¿ç”¨åŸç”Ÿæ–¹æ³•åˆå§‹åŒ–æˆåŠŸ');
            }
          } catch (nativeError) {
            console.warn('âš ï¸ åŸç”Ÿæ–¹æ³•åˆå§‹åŒ–å¤±è´¥:', nativeError);
            showFallbackContent('waifu1', 'MIHARI');
          }
        } else {
          console.warn('âš ï¸ æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„åˆå§‹åŒ–å‡½æ•°');
          showFallbackContent('waifu1', 'MIHARI');
        }
      } catch (error) {
        console.error('âŒ æ¿å¨˜1åˆå§‹åŒ–å¤±è´¥:', error);
        showFallbackContent('waifu1', 'MIHARI');
      }
      
      // å°è¯•åˆå§‹åŒ–æ¿å¨˜2ï¼ˆRory - ä¸­é—´ï¼‰
      try {
        console.log('ğŸ­ æ­£åœ¨åˆå§‹åŒ–æ¿å¨˜2 (Rory)...');
        if (typeof initModel === 'function') {
          initModel("live2d2", "waifu2");
          console.log('âœ… æ¿å¨˜2 (Rory) åˆå§‹åŒ–æˆåŠŸ');
        } else if (typeof initWidget === 'function') {
          initWidget("live2d2", "waifu2");
          console.log('âœ… æ¿å¨˜2 (Rory) ä½¿ç”¨initWidgetåˆå§‹åŒ–æˆåŠŸ');
        } else if (typeof window.Live2D !== 'undefined') {
          // å°è¯•ä½¿ç”¨Live2DåŸç”Ÿæ–¹æ³•
          const canvas = document.getElementById('live2d2');
          if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Rory', canvas.width/2, canvas.height/2);
            console.log('âœ… æ¿å¨˜2 (Rory) ä½¿ç”¨åŸç”Ÿæ–¹æ³•åˆå§‹åŒ–æˆåŠŸ');
          }
        } else {
          showFallbackContent('waifu2', 'Rory');
        }
      } catch (error) {
        console.error('âŒ æ¿å¨˜2åˆå§‹åŒ–å¤±è´¥:', error);
        showFallbackContent('waifu2', 'Rory');
      }
      
      // å°è¯•åˆå§‹åŒ–æ¿å¨˜3ï¼ˆAlya - åä¸‹ï¼‰
      try {
        console.log('ğŸ­ æ­£åœ¨åˆå§‹åŒ–æ¿å¨˜3 (Alya)...');
        if (typeof initModel === 'function') {
          initModel("live2d3", "waifu3");
          console.log('âœ… æ¿å¨˜3 (Alya) åˆå§‹åŒ–æˆåŠŸ');
        } else if (typeof initWidget === 'function') {
          initWidget("live2d3", "waifu3");
          console.log('âœ… æ¿å¨˜3 (Alya) ä½¿ç”¨initWidgetåˆå§‹åŒ–æˆåŠŸ');
        } else if (typeof window.Live2D !== 'undefined') {
          // å°è¯•ä½¿ç”¨Live2DåŸç”Ÿæ–¹æ³•
          const canvas = document.getElementById('live2d3');
          if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Alya', canvas.width/2, canvas.height/2);
            console.log('âœ… æ¿å¨˜3 (Alya) ä½¿ç”¨åŸç”Ÿæ–¹æ³•åˆå§‹åŒ–æˆåŠŸ');
          }
        } else {
          showFallbackContent('waifu3', 'Alya');
        }
      } catch (error) {
        console.error('âŒ æ¿å¨˜3åˆå§‹åŒ–å¤±è´¥:', error);
        showFallbackContent('waifu3', 'Alya');
      }
      
      console.log('=== Live2D åˆå§‹åŒ–å®Œæˆ ===');
    }, 2000); // å»¶è¿Ÿ2ç§’åˆå§‹åŒ–
    
    // å¤‡ç”¨å†…å®¹æ˜¾ç¤ºå‡½æ•°
    function showFallbackContent(elementId, name) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = `
          <div style="
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(100,100,100,0.8));
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255,255,255,0.3);
            font-family: Arial, sans-serif;
          ">
            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ­</div>
            <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">${name}</div>
            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 10px;">Live2Dæ¨¡å‹</div>
            <div style="font-size: 10px; opacity: 0.6; color: #ff6b6b;">åŠ è½½å¤±è´¥</div>
            <div style="font-size: 8px; opacity: 0.5; margin-top: 10px; color: #74b9ff;">è¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯</div>
          </div>
        `;
      }
    }
    
    // å…¨å±€å¤‡ç”¨å†…å®¹æ˜¾ç¤º
    function showAllFallbackContent() {
      showFallbackContent('waifu1', 'MIHARI');
      showFallbackContent('waifu2', 'Rory');
      showFallbackContent('waifu3', 'Alya');
    }
    
    // æ·»åŠ è°ƒè¯•æŒ‰é’®
    setTimeout(function() {
      addDebugButton();
    }, 1000);
    
    function addDebugButton() {
      const debugBtn = document.createElement('div');
      debugBtn.innerHTML = 'ğŸ›';
      debugBtn.style.cssText = `
        position: fixed;
        left: 20px;
        top: 20px;
        z-index: 10000;
        width: 40px;
        height: 40px;
        background: rgba(255,0,0,0.8);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 20px;
        transition: all 0.3s ease;
      `;
      
      debugBtn.addEventListener('click', function() {
        console.log('=== Live2D è°ƒè¯•ä¿¡æ¯ ===');
        console.log('jQueryç‰ˆæœ¬:', $.fn.jquery);
        console.log('Live2DModel:', typeof Live2DModel);
        console.log('initModel:', typeof initModel);
        console.log('waifu1å…ƒç´ :', document.getElementById('waifu1'));
        console.log('waifu2å…ƒç´ :', document.getElementById('waifu2'));
        console.log('waifu3å…ƒç´ :', document.getElementById('waifu3'));
        alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŒ‰F12æŸ¥çœ‹');
      });
      
      document.body.appendChild(debugBtn);
    }
  });
</script>

<!-- åŸç”ŸHTML5éŸ³é¢‘æ’­æ”¾å™¨ -->
<div id="audioPlayer" style="position: fixed; right: 20px; bottom: 20px; z-index: 10000; background: rgba(0,0,0,0.9); padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); min-width: 300px;">
  <div style="color: white; margin-bottom: 15px; text-align: center; font-size: 14px; font-weight: bold;">ğŸµ éŸ³ä¹æ’­æ”¾å™¨</div>
  
  <!-- éŸ³é¢‘æ§åˆ¶ -->
  <audio 
    id="mainAudio" 
    controls 
    style="width: 100%; height: 40px;"
    preload="metadata"
    src="{{ '/assets/audio/Summer.mp3' | relative_url }}">
    ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
  </audio>
  
  <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
  <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
    <button id="playBtn" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">æ’­æ”¾</button>
    <button id="pauseBtn" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">æš‚åœ</button>
    <button id="stopBtn" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">åœæ­¢</button>
  </div>
  
  <!-- éŸ³é‡æ§åˆ¶ -->
  <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
    <span style="color: white; font-size: 12px;">éŸ³é‡:</span>
    <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.7" style="flex: 1;">
    <span id="volumeValue" style="color: white; font-size: 12px;">70%</span>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const audio = document.getElementById('mainAudio');
  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const stopBtn = document.getElementById('stopBtn');
  const volumeControl = document.getElementById('volumeControl');
  const volumeValue = document.getElementById('volumeValue');
  
  // æ’­æ”¾æŒ‰é’®
  playBtn.addEventListener('click', function() {
    audio.play().then(() => {
      console.log('âœ… éŸ³é¢‘æ’­æ”¾æˆåŠŸ');
    }).catch(err => {
      console.log('âŒ æ’­æ”¾å¤±è´¥:', err.message);
      // æ˜¾ç¤ºç”¨æˆ·äº¤äº’æç¤º
      alert('è¯·ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®åå†è¯•æ’­æ”¾');
    });
  });
  
  // æš‚åœæŒ‰é’®
  pauseBtn.addEventListener('click', function() {
    audio.pause();
    console.log('â¸ï¸ éŸ³é¢‘å·²æš‚åœ');
  });
  
  // åœæ­¢æŒ‰é’®
  stopBtn.addEventListener('click', function() {
    audio.pause();
    audio.currentTime = 0;
    console.log('â¹ï¸ éŸ³é¢‘å·²åœæ­¢');
  });
  
  // éŸ³é‡æ§åˆ¶
  volumeControl.addEventListener('input', function() {
    const volume = this.value;
    audio.volume = volume;
    volumeValue.textContent = Math.round(volume * 100) + '%';
  });
  
  // éŸ³é¢‘äº‹ä»¶ç›‘å¬
  audio.addEventListener('play', function() {
    console.log('ğŸµ éŸ³é¢‘å¼€å§‹æ’­æ”¾');
    playBtn.style.background = '#28a745';
    playBtn.textContent = 'æ’­æ”¾ä¸­';
  });
  
  audio.addEventListener('pause', function() {
    console.log('â¸ï¸ éŸ³é¢‘å·²æš‚åœ');
    playBtn.style.background = '#007bff';
    playBtn.textContent = 'æ’­æ”¾';
  });
  
  audio.addEventListener('ended', function() {
    console.log('ğŸ éŸ³é¢‘æ’­æ”¾ç»“æŸ');
    playBtn.style.background = '#007bff';
    playBtn.textContent = 'æ’­æ”¾';
  });
  
  // å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼ˆå—æµè§ˆå™¨ç­–ç•¥é™åˆ¶ï¼‰
  setTimeout(() => {
    console.log('ğŸ”„ å°è¯•è‡ªåŠ¨æ’­æ”¾...');
    audio.play().catch(err => {
      console.log('âš ï¸ è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', err.message);
    });
  }, 2000);
  
  console.log('âœ… åŸç”ŸéŸ³é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–å®Œæˆ');
});
</script>
