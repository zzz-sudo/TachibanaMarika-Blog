<!-- jQuery库 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- 雪花特效 -->
<div id="midground" class="wall"></div>
<div id="foreground" class="wall"></div>
<div id="top" class="wall"></div>

<!-- 动态背景线条 -->
<div id="dynamic-background"></div>

<!-- 雪花特效JavaScript -->
<script type="text/javascript">
window.onload = function () {
    var minSize = 10; //最小字体
    var maxSize = 40;//最大字体
    var newOne = 500; //生成雪花间隔
    var flakColor = "#f5f5f5fa"; //雪花颜色
    var flak = $("<div></div>").css({position:"absolute","top":"0px"}).html("✽");//定义一个雪花
    var dhight = $(window).height(); //定义视图高度
    var dw =$(window).width()-80; //定义视图宽度
    setInterval(function(){
    var sizeflak = minSize+Math.random()*maxSize; //产生大小不等的雪花
    var startLeft = Math.random()*dw; //雪花生成是随机的left值
    var startOpacity = 0.7+Math.random()*0.3; //随机透明度
    var endTop= dhight-100; //雪花停止top的位置
    var endLeft= Math.random()*dw; //雪花停止的left位置
    var durationfull = 5000+Math.random()*3000; //雪花飘落速度不同
    flak.clone().appendTo($("body")).css({
    "left":startLeft ,
    "opacity":startOpacity,
    "font-size":sizeflak,
    "color":flakColor
    }).animate({
    "top":endTop,
    "left":endLeft,
    "apacity":0.1
    },durationfull,function(){
    $(this).remove()
    });
    },newOne);
};
</script>

<!-- 动态背景线条JavaScript -->
<script>
(function() {
    // 创建Canvas元素
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    
    // 设置Canvas样式
    canvas.style.position = 'fixed';
    canvas.style.top = '0';
    canvas.style.left = '0';
    canvas.style.width = '100%';
    canvas.style.height = '100%';
    canvas.style.zIndex = '-1';
    canvas.style.opacity = '0.3';
    canvas.style.pointerEvents = 'none';
    
    // 添加到页面
    document.body.appendChild(canvas);
    
    // 设置Canvas尺寸
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    
    // 初始化尺寸
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // 粒子数组
    var particles = [];
    var particleCount = 80; // 减少粒子数量以提高性能
    
    // 鼠标位置
    var mouse = {
        x: null,
        y: null
    };
    
    // 粒子类
    function Particle(x, y) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;
        this.size = Math.random() * 2 + 1;
    }
    
    // 更新粒子位置
    Particle.prototype.update = function() {
        this.x += this.vx;
        this.y += this.vy;
        
        // 边界检测
        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
    };
    
    // 绘制粒子
    Particle.prototype.draw = function() {
        ctx.fillStyle = 'rgba(255, 0, 0, 0.8)';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    };
    
    // 初始化粒子
    function initParticles() {
        particles = [];
        for (var i = 0; i < particleCount; i++) {
            particles.push(new Particle(
                Math.random() * canvas.width,
                Math.random() * canvas.height
            ));
        }
    }
    
    // 绘制连线
    function drawLines() {
        ctx.strokeStyle = 'rgba(255, 0, 0, 0.2)';
        ctx.lineWidth = 1;
        
        for (var i = 0; i < particles.length; i++) {
            for (var j = i + 1; j < particles.length; j++) {
                var dx = particles[i].x - particles[j].x;
                var dy = particles[i].y - particles[j].y;
                var distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 150) {
                    ctx.beginPath();
                    ctx.moveTo(particles[i].x, particles[i].y);
                    ctx.lineTo(particles[j].x, particles[j].y);
                    ctx.stroke();
                }
            }
            
            // 与鼠标连线
            if (mouse.x && mouse.y) {
                var dx = particles[i].x - mouse.x;
                var dy = particles[i].y - mouse.y;
                var distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 200) {
                    ctx.strokeStyle = 'rgba(255, 0, 0, 0.4)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(particles[i].x, particles[i].y);
                    ctx.lineTo(mouse.x, mouse.y);
                    ctx.stroke();
                }
            }
        }
    }
    
    // 动画循环
    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 更新和绘制粒子
        for (var i = 0; i < particles.length; i++) {
            particles[i].update();
            particles[i].draw();
        }
        
        // 绘制连线
        drawLines();
        
        requestAnimationFrame(animate);
    }
    
    // 鼠标事件
    canvas.addEventListener('mousemove', function(e) {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
    });
    
    canvas.addEventListener('mouseout', function() {
        mouse.x = null;
        mouse.y = null;
    });
    
    // 触摸事件支持
    canvas.addEventListener('touchmove', function(e) {
        e.preventDefault();
        var touch = e.touches[0];
        mouse.x = touch.clientX;
        mouse.y = touch.clientY;
    });
    
    // 启动动画
    initParticles();
    animate();
})();
</script>

{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

<!-- 地址栏图标功能 -->
<div class="favicon-changer" id="faviconChanger">
    地址栏图标已更改为 touxiang.jpg
</div>

<!-- 地址栏图标更换功能 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 设置默认图标
    const defaultFavicon = document.querySelector('link[rel="icon"]') || document.querySelector('link[rel="shortcut icon"]');
    
    // 创建新的图标链接
    const newFavicon = document.createElement('link');
    newFavicon.rel = 'icon';
    newFavicon.type = 'image/jpeg';
    newFavicon.href = '/touxiang.jpg';
    
    // 替换图标
    if (defaultFavicon) {
        defaultFavicon.remove();
    }
    document.head.appendChild(newFavicon);
    
    console.log('地址栏图标已更改为 touxiang.jpg');
    
    // 显示提示信息
    const faviconChanger = document.getElementById('faviconChanger');
    if (faviconChanger) {
        faviconChanger.classList.add('show');
        setTimeout(() => {
            faviconChanger.classList.remove('show');
        }, 3000);
    }
});
</script>

<!-- 社交媒体链接和日历功能 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 等待侧边栏加载完成
    setTimeout(function() {
        const sidebar = document.querySelector('.author__content');
        if (!sidebar) {
            console.log('未找到侧边栏');
            return;
        }
        
        // 添加社交媒体链接
        const socialLinks = document.createElement('div');
        socialLinks.className = 'social-links';
        socialLinks.innerHTML = `
            <a href="https://gitee.com/explore" class="social-link" target="_blank">
                <i class="fab fa-git-alt"></i>
                <span>Gitee</span>
            </a>
            <a href="https://github.com/zzz-sudo/" class="social-link" target="_blank">
                <i class="fab fa-github"></i>
                <span>GitHub</span>
            </a>
            <a href="https://wpa.qq.com/msgrd?v=3&uin=2364200290&site=qq&menu=yes" class="social-link" target="_blank">
                <i class="fab fa-qq"></i>
                <span>QQ</span>
            </a>
            <a href="https://t.me/xxx" class="social-link" target="_blank">
                <i class="fab fa-telegram"></i>
                <span>Telegram</span>
            </a>
            <a href="https://mp.weixin.qq.com/s/voNUF5iV1tghQvlRCEkpzg" class="social-link" target="_blank">
                <i class="fab fa-weixin"></i>
                <span>微信公众号</span>
            </a>
            <a href="https://www.bilibili.com/video/BV1dD4y1M748/?spm_id_from=333.1387.homepage.video_card.click" class="social-link" target="_blank">
                <i class="fab fa-bilibili"></i>
                <span>Bilibili</span>
            </a>
        `;
        sidebar.appendChild(socialLinks);
        console.log('社交媒体链接已添加到侧边栏');
        
        // 添加日历
        const calendarContainer = document.createElement('div');
        calendarContainer.className = 'calendar-container';
        calendarContainer.innerHTML = `
            <div class="calendar-header">
                <div class="calendar-title" id="calendarTitle">2025年8月</div>
                <div class="calendar-nav">
                    <button onclick="previousMonth()">&lt;</button>
                    <button onclick="nextMonth()">&gt;</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        `;
        sidebar.appendChild(calendarContainer);
        console.log('日历已添加到侧边栏');
        
        // 初始化日历
        initCalendar();
    }, 1000);
    
    // 日历功能
    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    
    function initCalendar() {
        renderCalendar();
    }
    
    function renderCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        const calendarTitle = document.getElementById('calendarTitle');
        
        if (!calendarGrid || !calendarTitle) return;
        
        calendarGrid.innerHTML = '';
        
        const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
        calendarTitle.textContent = `${currentYear}年${monthNames[currentMonth]}`;
        
        // 星期标题
        ['日', '一', '二', '三', '四', '五', '六'].forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-weekday';
            dayElement.textContent = day;
            calendarGrid.appendChild(dayElement);
        });
        
        // 日期
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const firstDayOfWeek = firstDay.getDay();
        const lastDate = lastDay.getDate();
        
        // 上个月日期
        const prevMonth = new Date(currentYear, currentMonth, 0);
        const prevMonthLastDate = prevMonth.getDate();
        for (let i = firstDayOfWeek - 1; i >= 0; i--) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = prevMonthLastDate - i;
            calendarGrid.appendChild(dayElement);
        }
        
        // 当月日期
        for (let day = 1; day <= lastDate; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            
            if (day === currentDate.getDate() && currentMonth === currentDate.getMonth() && currentYear === currentDate.getFullYear()) {
                dayElement.classList.add('today');
            }
            
            calendarGrid.appendChild(dayElement);
        }
        
        // 下个月日期
        const remainingDays = 42 - (firstDayOfWeek + lastDate);
        for (let day = 1; day <= remainingDays; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = day;
            calendarGrid.appendChild(dayElement);
        }
    }
    
    // 全局函数
    window.previousMonth = function() {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        renderCalendar();
    };
    
    window.nextMonth = function() {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar();
    };
});
</script>
