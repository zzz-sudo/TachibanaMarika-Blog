<!-- Live2D Widget HTML Template -->
<div id="live2d-widget">
    <div class="live2d-dialog" id="live2d-dialog"></div>
    <div class="live2d-controls">
        <button class="live2d-control-btn" id="live2d-toggle" title="显示/隐藏">👁</button>
        <button class="live2d-control-btn" id="live2d-settings" title="设置">⚙</button>
        <button class="live2d-control-btn" id="live2d-close" title="关闭">✕</button>
    </div>
</div>

<!-- Live2D Core Scripts -->
<script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/dist/live2d.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/dist/waifu-tips.js"></script>

<!-- Live2D Widget Scripts -->
<script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/dist/autoload.js"></script>

<!-- Custom Live2D Configuration -->
<script src="{{ '/assets/js/live2d-config.js' | relative_url }}"></script>
<script src="{{ '/assets/js/live2d-init.js' | relative_url }}"></script>

<!-- Live2D Widget Styles -->
<link rel="stylesheet" href="{{ '/assets/css/live2d.css' | relative_url }}">

<script>
// Live2D Widget Control Logic
document.addEventListener('DOMContentLoaded', function() {
    const widget = document.getElementById('live2d-widget');
    const dialog = document.getElementById('live2d-dialog');
    const toggleBtn = document.getElementById('live2d-toggle');
    const settingsBtn = document.getElementById('live2d-settings');
    const closeBtn = document.getElementById('live2d-close');
    
    let isVisible = true;
    let isInitialized = false;
    
    // 显示对话框
    function showDialog(text, duration = 3000) {
        if (dialog) {
            dialog.textContent = text;
            dialog.classList.add('show');
            setTimeout(() => {
                dialog.classList.remove('show');
            }, duration);
        }
    }
    
    // 切换显示/隐藏
    function toggleWidget() {
        if (isVisible) {
            widget.style.opacity = '0';
            widget.style.pointerEvents = 'none';
            isVisible = false;
            toggleBtn.textContent = '👁';
            showDialog('看板娘已隐藏');
        } else {
            widget.style.opacity = '1';
            widget.style.pointerEvents = 'auto';
            isVisible = true;
            toggleBtn.textContent = '🙈';
            showDialog('看板娘已显示');
        }
    }
    
    // 关闭看板娘
    function closeWidget() {
        widget.style.display = 'none';
        showDialog('看板娘已关闭');
        localStorage.setItem('live2d-widget-closed', 'true');
    }
    
    // 设置按钮
    function openSettings() {
        showDialog('设置功能开发中...');
    }
    
    // 绑定事件
    if (toggleBtn) toggleBtn.addEventListener('click', toggleWidget);
    if (settingsBtn) settingsBtn.addEventListener('click', openSettings);
    if (closeBtn) closeBtn.addEventListener('click', closeWidget);
    
    // 检查是否应该显示
    if (localStorage.getItem('live2d-widget-closed') === 'true') {
        widget.style.display = 'none';
    }
    
    // 初始化完成后的回调
    if (typeof Live2DWidget !== 'undefined') {
        Live2DWidget.on('modelLoaded', function() {
            isInitialized = true;
            showDialog('看板娘加载完成！');
        });
        
        Live2DWidget.on('modelError', function(error) {
            console.error('Live2D模型加载失败:', error);
            showDialog('模型加载失败，请检查文件路径');
        });
    }
    
    // 页面加载完成后的欢迎语
    setTimeout(() => {
        if (isInitialized) {
            showDialog('欢迎来到我的博客！');
        }
    }, 2000);
});
</script> 